(this.webpackJsonpCSN=this.webpackJsonpCSN||[]).push([[0],{106:function(e,t,s){},107:function(e,t,s){},118:function(e,t,s){},126:function(e,t,s){},135:function(e,t,s){"use strict";s.r(t);var i=s(0),a=s.n(i),r=s(13),n=s.n(r),o=(s(106),s(63)),l=s(6),c=(s(107),s(2));class h extends i.Component{constructor(e){super(e),this.state={dimensions:{},imgURL:null,previewImage:!1,timeoutId:null}}componentDidMount(){this.props.setPreviewPaneCanvas(this.side_canvas)}componentDidUpdate(e){if(this.props.hover_index!==e.hover_index){this.setState({previewImage:!1}),clearTimeout(this.state.timeoutId);const e=setTimeout((()=>{this.setState({previewImage:!0})}),100);this.setState({timeoutId:e})}}render(){let{previewPane_image_size:e}=this.props;return Object(c.jsxs)("div",{children:[Object(c.jsxs)("div",{style:{position:"absolute",width:e,height:e,textAlign:"center"},children:[Object(c.jsx)("span",{style:{display:"inline-block",height:"100%",verticalAlign:"middle"}}),!0===this.state.previewImage?this.props.setPreviewImage():null]}),Object(c.jsx)("canvas",{ref:e=>{this.side_canvas=e},width:e,height:e})]})}}var d=a.a.memo(h),p=s(169),m=s(173),u=s(177),g=s(45),j=s(168),b=s(7);const v=12;const x=Object(b.a)((e=>({rail:{backgroundColor:e.palette.grey[400],width:"100%",height:2,position:"absolute",pointerEvents:"none"},railHotspot:{width:"100%",height:24,top:-12,position:"absolute",cursor:"pointer"}})))((function(e){let{classes:t,getRailProps:s}=e;return Object(c.jsxs)(i.Fragment,{children:[Object(c.jsx)("div",{className:t.railHotspot,...s()}),Object(c.jsx)("div",{className:t.rail})]})}));const f=Object(b.a)((e=>({root:{backgroundColor:e.palette.secondary.main,marginLeft:-6,marginTop:-6,width:v,height:v,border:0,borderRadius:"50%",whiteSpace:"nowrap",position:"absolute",zIndex:2,cursor:"pointer"}})))((function(e){let{domain:[t,s],handle:{id:i,value:a,percent:r},classes:n,getHandleProps:o}=e;return Object(c.jsx)("div",{role:"slider","aria-valuemin":t,"aria-valuemax":s,"aria-valuenow":a,className:n.root,style:{left:"".concat(r,"%")},...o(i)})}));const O=Object(b.a)((e=>({track:{backgroundColor:e.palette.secondary.main,height:2,position:"absolute",zIndex:1,pointerEvents:"none"},trackHotspot:{height:v,top:-6,position:"absolute",cursor:"pointer"}})))((function(e){let{classes:t,source:s,target:a,getTrackProps:r}=e;const n="".concat(s.percent,"%"),o="".concat(a.percent-s.percent,"%");return Object(c.jsxs)(i.Fragment,{children:[Object(c.jsx)("div",{className:t.track,style:{left:n,width:o}}),Object(c.jsx)("div",{className:t.trackHotspot,style:{left:n,width:o},...r()})]})}));function y(e){let{classes:t,tick:s,count:i,format:a}=e;return Object(c.jsxs)("div",{children:[Object(c.jsx)("div",{className:t.tick,style:{left:"".concat(s.percent,"%")}}),Object(c.jsx)(j.a,{className:t.label,variant:"caption",style:{marginLeft:"".concat(-100/i/2,"%"),width:"".concat(100/i,"%"),left:"".concat(s.percent,"%")},children:a(s.value)})]})}y.defaultProps={format:e=>e};Object(b.a)((e=>({tick:{position:"absolute",marginTop:14,width:1,height:5,backgroundColor:e.palette.grey[400]},label:{position:"absolute",marginTop:22,textAlign:"center"}})))(y);var _=s(65);class w extends a.a.Component{constructor(e){super(e),this.state={isHovering:!1,barSelected:null},this.onLeave=this.onLeave.bind(this)}calculateHistogram(e,t){let s=[];for(let h=0;h<this.props.settings.total;h++)0===this.props.currentProjection[h]&&s.push(this.props.metadata[h][this.props.sliderID]);var i={};this.bucketsFinder={};var a,r;a=e[0]<0?(Math.abs(e[0])+Math.abs(e[1]))/50:Math.abs((Math.abs(e[0])-Math.abs(e[1]))/50);for(let h=0;h<50;h++)i[h]=0;for(var n=0;n<s.length;n++)i[r=s[n]===e[1]?49:(s[n]-e[0])/a|0]+=1,this.bucketsFinder[parseFloat(s[n]).toFixed(1)]=r;var o=Object.values(i);if(!0===t){var l=Math.max.apply(Math,o)/50;for(n=0;n<o.length;n++)o[n]=Math.round(o[n]/l)}const c=[];for(let h=0;h<o.length;h++)c.push(o[h]||0);return c}hoverEffect(e){if(this.setState({isHovering:!0}),e[0]){var t=e[0].index,s=new Float32Array(this.props.settings.total).fill(1),i=this.props.currentProjection;this.props.barData.selections[t].forEach((e=>{s[e]=i[e]})),this.props.calculateProjection(s,null,!1),this.setState({barSelected:t})}}onLeave(){this.setState({isHovering:!1}),this.props.calculateProjection(this.props.currentProjection,null,!1)}render(){const{barData:e,domain:t,color:s,selected:i}=this.props;_.b.animation=!1;var a=Array(50).fill(0);this.barDataSoll=e.histogram,this.barDataIst=this.calculateHistogram(t,!1);const r={labels:this.barDataSoll.map(((e,t)=>t)),datasets:[{label:"barDataIst",type:"bar",barThickness:5,normalized:!0,order:2,backgroundColor:this.state.isHovering?"rgb(64, 64, 64)":a.map(((e,t)=>t===this.bucketsFinder[parseFloat(i).toFixed(1)]?"#f50057":s)),hoverBackgroundColor:s,data:this.barDataIst},{label:"barDataSoll",type:"bar",barThickness:5,normalized:!0,order:3,backgroundColor:a.map(((e,t)=>t===this.bucketsFinder[parseFloat(i).toFixed(1)]?"#542032":"rgb(64, 64, 64)")),hoverBackgroundColor:"rgb(64, 64, 64)",data:this.barDataSoll}]},n={responsive:!0,interaction:{mode:"index",intersect:!1},events:["mouseleave","mousemove","mouseout","click"],hoverBackgroundColor:s,onClick:()=>{this.setState({isHovering:!this.state.isHovering}),this.props.calculateProjection(this.props.currentProjection,null,!1)},onHover:(e,t)=>{"mousemove"===e.type&&this.state.isHovering&&this.state.barSelected!==t[0].index?(this.setState({bgColor:"rgb(64, 64, 64)"}),this.hoverEffect(t),"ew-resize"!==e.native.target.style.cursor&&(e.native.target.style.cursor="ew-resize")):this.state.isHovering||"pointer"===e.native.target.style.cursor||(e.native.target.style.cursor="pointer")},plugins:{legend:{display:!1},tooltip:{enabled:!1}},scales:{x:{display:!1,stacked:!0},yAxes:{beginAtZero:!0,display:!1}}};return Object(c.jsx)(_.a,{data:r,height:62,options:n,onMouseLeave:this.onLeave})}}var S=a.a.memo(w);class C extends a.a.Component{constructor(){super(...arguments),this.state={domain:this.props.range,update:this.props.range,values:this.props.range,inputValues:this.props.range,typeNumber:this.props.typeNumber,step:this.props.step,color:this.props.color,hover_index:this.props.hover_index,isToggleOn:!1},this.handleClick=e=>{this.setState((e=>({isToggleOn:!e.isToggleOn}))),e.stopPropagation()},this.changeSlider=e=>{this.props.onChangeSlider(this.props.id,e)}}render(){const{domain:e,values:t,update:s,inputValues:i,color:a,typeNumber:r}=this.state;return Object(c.jsx)(p.a,{container:!0,children:Object(c.jsx)(p.a,{item:!0,xs:12,children:Object(c.jsxs)("div",{style:{height:"90px",width:"270px",marginTop:"22px"},children:[Object(c.jsx)(S,{update:s,domain:e,color:a,barData:this.props.barData,calculateProjection:this.props.calculateProjection,settings:this.props.settings,currentProjection:this.props.currentProjection,sliderID:this.props.sliderID,metadata:this.props.metadata,selected:this.props.metadata[this.props.hover_index][this.props.sliderID]}),Object(c.jsxs)(g.c,{mode:3,step:"int"===r?1:.01,domain:e,color:a,rootStyle:{position:"relative",width:"100%"},onUpdate:e=>{this.setState({update:e,inputValues:e})},onChange:e=>{this.setState({values:e}),this.changeSlider(s)},values:t,children:[Object(c.jsx)(g.b,{children:e=>{let{getRailProps:t}=e;return Object(c.jsx)(x,{getRailProps:t})}}),Object(c.jsx)(g.a,{children:t=>{let{handles:s,getHandleProps:i}=t;return Object(c.jsx)("div",{className:"slider-handles",children:s.map((t=>Object(c.jsx)(f,{handle:t,domain:e,getHandleProps:i},t.id)))})}}),Object(c.jsx)(g.d,{left:!1,right:!1,children:e=>{let{tracks:t,getTrackProps:s}=e;return Object(c.jsx)("div",{className:"slider-tracks",children:t.map((e=>{let{id:t,source:i,target:a}=e;return Object(c.jsx)(O,{source:i,target:a,getTrackProps:s},t)}))})}})]}),Object(c.jsxs)(p.a,{container:!0,alignItems:"center",justifyContent:"space-around",children:[Object(c.jsx)(p.a,{item:!0,xs:3,style:{textAlign:"right",border:"solid 1px white",height:"20px",marginLeft:"auto",marginRight:"auto"},children:Object(c.jsx)(m.a,{fullWidth:!0,variant:"outlined",label:"",size:"small",width:"8px",value:i[0],margin:"none",inputProps:{style:{color:"white",padding:0,marginLeft:2}},onChange:t=>{const s=t.target.value,a=[s,i[1]];this.setState({inputValues:a}),s&&s>=e[0]&&this.setState({values:a})}})}),Object(c.jsx)(p.a,{item:!0,xs:4,style:{textAlign:"center",marginTop:"-6px"},children:Object(c.jsx)(u.a,{title:Object(c.jsx)("h3",{children:this.props.info}),children:Object(c.jsx)("h3",{style:{cursor:"help"},children:this.props.title})})}),Object(c.jsx)(p.a,{item:!0,xs:3,style:{textAlign:"right",border:"solid 1px white",height:"20px",marginLeft:"auto",marginRight:"auto"},children:Object(c.jsx)(m.a,{fullWidth:!0,variant:"outlined",label:"",size:"small",value:i[1],margin:"none",inputProps:{style:{color:"white",padding:0,marginLeft:2}},onChange:s=>{const a=s.target.value,r=[i[0],a];this.setState({inputValues:r}),a&&a<=e[1]&&a>=t[0]&&this.setState({values:r})}})})]})]})})})}}var P=a.a.memo(C);class D extends i.Component{constructor(e){super(e),this.changeSlider=this.changeSlider.bind(this),this.slidersAr=[];for(let t in this.props.settings.sliders)this.slidersAr.push(this.props.settings.sliders[t].id);this.refSliders={},this.filterData={},this.filtered={};for(let t=0;t<this.slidersAr.length;t+=1){this.refSliders[this.slidersAr[t]]=a.a.createRef();let e=[];for(let s in this.props.metadata)e.push(this.props.metadata[s][this.slidersAr[t]]);this.filterData[this.slidersAr[t]]=e}this.state={datafilter:this.filterData}}changeSlider(e,t){let{metadata:s}=this.props;this.filtered[e]=new Float32Array(this.props.settings.total).fill(0);let i=new Float32Array(this.props.settings.total);for(let n in s)(t[0]>s[n][e]||t[1]<s[n][e])&&(this.filtered[e][n]=1);let a=Object.values(this.filtered),r=i.map(((e,t)=>a.reduce(((e,s)=>e+s[t]),0)));this.props.calculateProjection(r,"filter",!0)}render(){let{hover_index:e,settings:t,barData:s}=this.props;const i=t.sliders.map((i=>Object(c.jsx)(p.a,{item:!0,children:Object(c.jsx)(P,{ref:this.refSliders[i.id],datafilter:this.state.datafilter[i.id],title:i.title,id:i.id,info:i.info,typeNumber:i.typeNumber,color:i.color,onChangeSlider:this.changeSlider,hover_index:e,barData:s[i.id],calculateProjection:this.props.calculateProjection,currentProjection:this.props.currentProjection,settings:t,sliderID:i.id,metadata:this.props.metadata,range:[i.min,i.max]})})));return Object(c.jsx)(p.a,{container:!0,style:{marginLeft:"6px"},children:Object(c.jsx)(p.a,{item:!0,children:i})})}}var z=D;class A extends i.Component{constructor(e){super(e),this.sliderReset=this.sliderReset.bind(this)}sliderReset(){console.log("reset range sliders")}render(){let{metadata:e,hover_index:t}=this.props;return Object(c.jsx)(z,{metadata:e,settings:this.props.settings,hover_index:t,barData:this.props.barData,filterImageAr:this.props.filterImageAr,calculateProjection:this.props.calculateProjection,currentProjection:this.props.currentProjection})}}var k=a.a.memo(A),F=s(19),T=s(171),M=s(137),I=s(64),N=s.n(I);s(118);class R extends I.SimpleResultProcessing{filter(e,t,s,i){var a=this.tryToGetFieldCategory(t);switch(s){case"==":return e[a]===i;case"!=":return e[a]!==i;case"contains":return e[a]&&e[a].toLowerCase().indexOf(i.toLowerCase())>=0;case"!contains":return e[a]&&e[a].toLowerCase().indexOf(i.toLowerCase())<0;default:return!1}}}class H extends i.Component{constructor(e){super(e),this.exportMetadata=()=>{var e=[];for(let s=0;s<this.props.metadata.length;s++)if(0===this.props.currentProjection[s]){var t=this.props.metadata[s];e.push(t)}this.setState({filterDataToExportCSV:e},(()=>{document.getElementsByClassName("hidden")[0].click()}))},this.state={parseOK:!0,query2:{}},this.applyFilter=this.applyFilter.bind(this),this.resetFilter=this.resetFilter.bind(this),this.options=this.props.settings.search}applyFilter(){var e=new R(this.options).process(this.props.metadata,this.state.query2),t=new Float32Array(this.props.settings.total).fill(1);e.forEach((e=>{t[e.index]=0})),this.props.calculateProjection(t,"search",!0)}resetFilter(){this.setState({query:null,query2:""});var e=new Float32Array(this.props.settings.total).fill(0);this.props.calculateProjection(e,"search",!0)}customRenderCompletionItem(e,t,s){var i="hint-value cm-".concat(t.type);return Object(c.jsxs)("div",{className:i,children:[Object(c.jsx)("span",{style:{fontWeight:"bold"},children:t.value}),Object(c.jsxs)("span",{style:{color:"gray",fontSize:10},children:[" [",t.type,"] "]})]})}onParseOk(e){this.setState({parseOK:!1}),this.setState({query2:e})}onParseError(e){this.setState({parseOK:!0})}render(){return Object(c.jsxs)("div",{className:"main-container",children:[Object(c.jsx)(N.a,{customRenderCompletionItem:this.customRenderCompletionItem.bind(this),query:this.state.query,data:this.props.metadata,options:this.options,onParseOk:this.onParseOk.bind(this),onParseError:this.onParseError.bind(this),editorConfig:{lineWrapping:!0}}),Object(c.jsxs)(T.a,{variant:"contained",children:[Object(c.jsx)(M.a,{onClick:this.applyFilter,children:"apply"}),Object(c.jsx)(M.a,{onClick:this.resetFilter,children:"reset"})]})]})}}var E=H;class L extends i.Component{render(){let{metadata:e,settings:t}=this.props;return Object(c.jsx)(p.a,{container:!0,spacing:2,children:Object(c.jsx)(E,{calculateProjection:this.props.calculateProjection,settings:t,metadata:e,currentProjection:this.props.currentProjection,allFilter:this.props.allFilter})})}}var U=a.a.memo(L),G=s(55),V=s.n(G);class q extends i.Component{constructor(e){super(e),this.state={}}render(){let{metadata:e,hover_index:t,infos:s}=this.props;const a={color:"CornflowerBlue"},r=s.map((s=>Object(c.jsxs)(i.Fragment,{children:[Object(c.jsxs)(p.a,{item:!0,xs:4,children:[s,":"]},V()()),Object(c.jsx)(p.a,{item:!0,xs:8,children:"string"===typeof e[t][s]&&e[t][s].length>4&&"http"===e[t][s].substring(0,4)?Object(c.jsxs)("a",{href:e[t][s],target:"_blank",rel:"noreferrer",style:a,children:[e[t][s].substring(8,30),"..."]}):e[t][s]},V()())]})));return Object(c.jsx)(p.a,{container:!0,justifyContent:"space-between",spacing:1,wrap:"wrap",children:r},V()())}}var Z=q;class B extends i.Component{constructor(e){super(e),this.state={dimensions:{}}}render(){let{hover_index:e,infos:t,metadata:s}=this.props;return Object(c.jsx)(Z,{metadata:s,hover_index:e,infos:t})}}var W=a.a.memo(B),K=s(175),J=s(178);class Y extends i.Component{constructor(e){super(e),this.handleChange=()=>{this.setState((e=>({checked:!e.checked}))),this.props.handleChangeGrey(this.state.checked?1:0)},this.state={dimensions:{},checked:this.props.filterGrey}}render(){let{clusters:e}=this.props;return Object(c.jsxs)(p.a,{container:!0,spacing:1,children:[Object(c.jsx)(p.a,{item:!0,xs:4,children:"clusters:"}),Object(c.jsx)(p.a,{item:!0,xs:8,children:Object(c.jsxs)("select",{onChange:this.props.handleChangeCluster,children:[Object(c.jsx)("option",{value:"disabled",children:"-"},"0"),e.clusterList.map(((e,t)=>Object(c.jsx)("option",{value:e,children:e.toLowerCase()},e)))]})}),Object(c.jsx)(p.a,{item:!0,xs:4,children:"size (out):"}),Object(c.jsx)(p.a,{item:!0,xs:8,children:Object(c.jsx)(K.a,{height:10,children:Object(c.jsx)(J.a,{size:"small",defaultValue:this.props.scaleMin,min:3,max:60,onChange:this.props.handleChangeScale})})}),Object(c.jsx)(p.a,{item:!0,xs:4,children:"size (in):"}),Object(c.jsx)(p.a,{item:!0,xs:8,children:Object(c.jsx)(K.a,{height:10,children:Object(c.jsx)(J.a,{size:"small",defaultValue:this.props.scaleMax,min:3,max:120,onChange:this.props.handleChangeZoom})})}),Object(c.jsx)(p.a,{item:!0,xs:11,children:"show filtered-out items (slower):"}),Object(c.jsx)(p.a,{item:!0,xs:1,children:Object(c.jsx)("input",{type:"checkbox",checked:this.state.checked,onChange:this.handleChange})})]})}}var $=a.a.memo(Y);class Q extends i.Component{constructor(e){super(e),this.handleSelectAlgorithm=this.handleSelectAlgorithm.bind(this),this.handleSelectDataset=this.handleSelectDataset.bind(this)}handleSelectAlgorithm(e){let t=e.target.value;this.props.selectAlgorithm(t)}handleSelectDataset(e){let t=e.target.value;this.props.selectDataset(t)}render(){let{algorithm_options:e,algorithm_choice:t,dataset_options:s,selectedDataset:i,datasetInfo:a}=this.props;return Object(c.jsxs)(p.a,{container:!0,spacing:1,children:[Object(c.jsx)(p.a,{item:!0,xs:4,children:"Dataset:"}),Object(c.jsx)(p.a,{item:!0,xs:8,children:Object(c.jsx)("select",{className:"full-width",onChange:this.handleSelectDataset,value:i,children:s.map(((e,t)=>Object(c.jsx)("option",{value:e,children:e},e)))})}),Object(c.jsx)(p.a,{item:!0,xs:4,children:"Projection:"}),Object(c.jsx)(p.a,{item:!0,xs:8,children:Object(c.jsx)("select",{className:"full-width",onChange:this.handleSelectAlgorithm,value:e[t],children:e.map(((e,t)=>Object(c.jsx)("option",{value:e,children:e},e)))})}),Object(c.jsx)(p.a,{item:!0,xs:12,children:Object(c.jsx)("p",{className:"info",children:a})})]})}}var X=a.a.memo(Q),ee=s(79),te=s(80),se=s.n(te);class ie extends i.Component{constructor(e){super(e),this.makePNG=async()=>{console.log("download projection area as png"),se()(document.getElementById("threeCanvas"))},this.state={filterDataToExportCSV:[]}}render(){let{metadata:e,currentProjection:t}=this.props;return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("div",{style:{marginBottom:"12px"},children:Object(c.jsx)(ee.CSVLink,{data:this.state.filterDataToExportCSV,filename:"CSN_filtered_metadata.csv",target:"_blank",onClick:()=>{let s=[];for(let a=0;a<e.length;a++)if(0===t[a]){var i=e[a];s.push(i)}this.setState({filterDataToExportCSV:s})},children:Object(c.jsx)(M.a,{variant:"contained",fullWidth:!0,children:"Download metadata CSV"})})}),Object(c.jsx)("div",{children:Object(c.jsx)(M.a,{variant:"contained",fullWidth:!0,onClick:this.makePNG,children:"Download projection PNG"})})]})}}var ae=a.a.memo(ie),re=s(15),ne=(s(126),s(12)),oe=s(24),le=s(56),ce=s(172);class he extends i.Component{constructor(e){super(e),this.handleResize=(e,t)=>{this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t);let s=this.getScaleFromZ(this.camera.position.z),i=-this.camera.position.x*s+this.props.width/2,a=this.camera.position.y*s+this.props.height/2;var r=oe.f.translate(i,a).scale(s);let n=oe.d(this.mount);this.d3_zoom.transform(n,r)},this.updateProjection=e=>{this.filterAr=e;let t=[],s=[];for(let i=0;i<this.props.settings.sprite_number;i++){let a=i*this.sprite_size,r=(i+1)*this.sprite_size;i===this.props.settings.sprite_number-1&&(r=this.props.settings.sprite_number*this.sprite_size),t.push([a,r]),s.push(e.slice(a,r))}for(let i=0;i<this.props.settings.sprite_number;i++){let e=this.scene.children[0].children[i];e.geometry.attributes.filteredActive=new ne.a(s[i],1),e.geometry.attributes.filteredActive.needsUpdate=!0}},this.updatePass2Shader=e=>{for(let t=0;t<this.props.settings.sprite_number;t++){let s=this.scene.children[0].children[t];1===e&&(s.material.uniforms.greyTransparency.value=.1,s.material.uniforms.greyTransparency.needsUpdate=!0,s.material.uniforms.imageTransparency.value=1,s.material.uniforms.imageTransparency.needsUpdate=!0),2===e&&(s.material.uniforms.greyTransparency.value=0,s.material.uniforms.greyTransparency.needsUpdate=!0,s.material.uniforms.imageTransparency.value=0,s.material.uniforms.imageTransparency.needsUpdate=!0)}},this.updateClusterColors=e=>{console.log("updateClusterColors",e);let t=this.props.metadata.length;console.log("clusterSelected:",e,"numVertices Update --\x3e",t," metadata.length:",this.props.metadata.length);let s=new Float32Array(3*t),i=this.props.settings.clusters.clusterColors;console.log(t,"-"!==e,this.props.settings.total,i);let a=[],r=[];if("disabled"!==e){let n=[];for(let a=0,r=0,o=t;a<o;a++,r+=1){let t=this.props.metadata[r][e];-1===n.indexOf(t)&&n.push(t);let a=n.indexOf(t);a>=i.length?(s[3*r]=Math.random(),s[3*r+1]=Math.random(),s[3*r+2]=Math.random()):(s[3*r]=i[a][0],s[3*r+1]=i[a][1],s[3*r+2]=i[a][2])}for(let e=0;e<this.props.settings.sprite_number;e++){let t=e*this.sprite_size,i=(e+1)*this.sprite_size;e===this.props.settings.sprite_number-1&&(i=this.props.settings.sprite_number*this.sprite_size),a.push([t,i]),r.push(s.slice(3*t,3*i))}}for(let n=0;n<this.props.settings.sprite_number;n++){let t=this.scene.children[0].children[n];"disabled"!==e?(t.geometry.attributes.cluster=new ne.a(r[n],3),t.geometry.attributes.cluster.needsUpdate=!0,t.material.uniforms.clusterActive.value=1,t.material.uniforms.clusterActive.needsUpdate=!0):(t.material.uniforms.clusterActive.value=0,t.material.uniforms.clusterActive.needsUpdate=!0)}},this.loadTiles(),this.state={tilesLoaded:0,view:null},this.init=this.init.bind(this),this.pointsAr=[],this.addPoints=this.addPoints.bind(this),this.handleResize=this.handleResize.bind(this),this.setupCamera=this.setupCamera.bind(this),this.animate=this.animate.bind(this),this.getScaleFromZ=this.getScaleFromZ.bind(this),this.getZFromScale=this.getZFromScale.bind(this),this.changeEmbeddings=this.changeEmbeddings.bind(this)}loadTiles(){this.sprite_size=this.props.settings.sprite_side*this.props.settings.sprite_side,this.tile_locations=[...Array(this.props.settings.sprite_number)].map(((e,t)=>"".concat("/study-interaction","/datasets/").concat(this.props.settings.sprite_dir,"/tile_").concat(t,".png"))),this.datasetIMG=this.tile_locations.map((e=>{let t=document.createElement("img");return t.src=e,t}))}changeEmbeddings(e){let t=[];for(let i=0;i<this.props.settings.sprite_number;i++){let e=i*this.sprite_size,s=(i+1)*this.sprite_size;i===this.props.settings.sprite_number-1&&(s=this.props.settings.sprite_number*this.sprite_size),t.push([e,s])}let s=t.map((t=>this.props.mappings[e].slice(t[0],t[1])));for(let i=0;i<this.props.settings.sprite_number;i++){let e=s[i],t=this.scene.children[0].children[i],a=e.length,r=t.geometry.attributes.position.array,n=new Float32Array(3*a);for(let s=0,i=0,l=a;s<l;s++,i+=3){let t=e[s][0],a=e[s][1],r=0;n[i]=t,n[i+1]=a,n[i+2]=r}let o=new le.b(r).to(n,1e3).easing(le.a.Linear.None);o.onUpdate((function(){t.geometry.attributes.position=new ne.a(r,3),t.geometry.attributes.position.needsUpdate=!0})),o.start()}}zoomScaler(e){return oe.c().domain([20,0]).range([this.props.scaleMin,this.props.scaleMax]).clamp(!0)(e)}getZFromScale(e){let t=ne.d.degToRad(this.camera.fov);return this.props.height/e/(2*Math.tan(t/2))}getScaleFromZ(e){let t=ne.d.degToRad(this.camera.fov),s=2*(Math.tan(t/2)*e);return this.props.height/s}zoomHandler(){let e=oe.a.transform,t=e.k,s=-(e.x-this.props.width/2)/t,i=(e.y-this.props.height/2)/t,a=this.getZFromScale(t);this.camera.position.set(s,i,a);let r=this.zoomScaler(a),n=this.scene.children[0].children;for(let o=0;o<n.length;o++)n[o].material.uniforms.size.value=r}setupCamera(){let e,{width:t,height:s,embeddings_data:i}=this.props,a=this.camera.fov,r=ne.d.degToRad(a),n=i.map((e=>e[0])),o=F.min(n),l=F.max(n),c=i.map((e=>e[1])),h=F.min(c),d=F.max(c),p=F.max([o,l].map((e=>Math.abs(e)))),m=F.max([h,d].map((e=>Math.abs(e))));e=Math.max(p,m)/Math.tan(r/2);let u=1.25*e;this.camera.far=u,this.camera.position.z=1.1*e,this.d3_zoom=oe.e().scaleExtent([this.getScaleFromZ(u-1),this.getScaleFromZ(.1)]).on("zoom",this.zoomHandler.bind(this));let g=oe.d(this.mount);this.view=g,g.call(this.d3_zoom);let j=this.getScaleFromZ(this.camera.position.z);var b=oe.f.translate(t/2,s/2).scale(j);this.d3_zoom.transform(g,b),this.setState({view:g})}addPoints(){let{embeddings_data:e,metadata:t}=this.props,s=[];for(let o=0;o<this.props.settings.sprite_number;o++){let e=o*this.sprite_size,t=(o+1)*this.sprite_size;o===this.props.settings.sprite_number-1&&(t=this.props.settings.sprite_number*this.sprite_size),s.push([e,t])}let i,a=s.map((t=>e.slice(t[0],t[1]))),r=new ne.k;this.textures=this.tile_locations.map((e=>{let t=r.load(e,function(e){this.setState({tilesLoaded:this.state.tilesLoaded+1})}.bind(this));return t.flipY=!1,t.magFilter=ne.e,t}));let n=new ne.c;for(let o=0;o<this.props.settings.sprite_number;o++){let e=a[o],s=[];for(let t=0;t<e.length;t++){let i=e[t],a=new ne.m(i[0],i[1],0);s[t]=a}i=new ne.b;let r=s.length,l=new Float32Array(3*r),c=new Float32Array(2*r),h=new Float32Array(3*r),d=new Float32Array(r);i.addAttribute("position",new ne.a(l,3)),i.addAttribute("offset",new ne.a(c,2)),i.addAttribute("filter",new ne.a(d,1)),i.addAttribute("cluster",new ne.a(h,3));for(let t=0,i=0,a=r;t<a;t++,i+=3){let s=e[t][0],a=e[t][1],r=0;l[i]=s,l[i+1]=a,l[i+2]=r}let p=1/this.props.settings.sprite_side;for(let t=0,i=0,a=r;t<a;t++,i+=2){let e=t%this.props.settings.sprite_side*this.props.settings.sprite_image_size/this.props.settings.sprite_actual_size,s=Math.floor(t/this.props.settings.sprite_side)*this.props.settings.sprite_image_size/this.props.settings.sprite_actual_size;c[i]=e,c[i+1]=s}if(this.props.settings.clusters.clusterList){let e=this.props.clusterTypeSelected,s=this.props.settings.clusters.clusterColors;for(let i=0,a=0,n=r;i<n;i++,a+=1)if(d[a]=0,"-"!==e&&this.props.settings.clusters.clusterList.includes(e)){let i=t[a][e];i>=s.length?(h[3*a]=1,h[3*a+1]=1,h[3*a+2]=1):(h[3*a]=s[i][0],h[3*a+1]=s[i][1],h[3*a+2]=s[i][2])}}let m={texture:{value:this.textures[o]},repeat:{value:new ne.l(p,p)},size:{value:this.props.settings.sprite_image_size},greyTransparency:{value:.1},imageTransparency:{value:1},clusterActive:{value:0}},u="\n        attribute vec2 offset;\n        varying vec2 vOffset;\n        attribute vec3 cluster;\n        varying vec3 vCluster;\n        attribute float filteredActive;\n        varying float vFilteredActive;\n        uniform float clusterActive;\n        varying float vClusterActive;\n        uniform float size;\n        uniform float greyTransparency;\n        varying float vGreyTransparency;\n        uniform float imageTransparency;\n        varying float vImageTransparency;\n\n        void main() {\n          vOffset = offset;\n          vFilteredActive = filteredActive;\n          vCluster = cluster;\n          vClusterActive = clusterActive;\n          vGreyTransparency = greyTransparency;\n          vImageTransparency = imageTransparency;\n          gl_PointSize = size;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",g="\n        uniform sampler2D texture;\n        uniform vec2 repeat;\n        varying vec2 vOffset;\n        varying vec3 vCluster;\n        varying float vClusterActive;\n        varying float vFilteredActive;\n        varying float vGreyTransparency;\n        varying float vImageTransparency;\n        void main() {\n          vec2 uv = vec2( gl_PointCoord.x, gl_PointCoord.y );\n          vec4 tex = texture2D( texture, uv * repeat + vOffset );\n          // make transparent images\n          if ( tex.a < 0.003 ) discard;\n\n          // Display clusters\n          vec4 replace_color = vec4(vCluster,1.0);\n          vec4 default_border_color = vec4(0.00392156863,0.00392156863,0.00392156863,0.0);\n          vec4 diff = tex - default_border_color;\n          float equality = float(dot(diff,diff) < 0.99 && vClusterActive > 0.9);\n          tex = mix( tex, replace_color, equality);\n           \n          // make transparent images\n          tex = mix( tex,  vec4(0.0,0.0,0.0,0.0), vImageTransparency);\n\n          // Grey images filter our selection \n          vec4 filterout_color = vec4(0.3,0.3,0.3,vGreyTransparency);\n          float filterout_equality = float(vFilteredActive > 0.9);\n          tex = mix( tex, filterout_color, filterout_equality );\n          gl_FragColor = tex; //* vec4(vColor, 1.0);\n        }",j=new ne.j({uniforms:m,vertexShader:u,fragmentShader:g,transparent:!0}),b=new ne.g(i,j);b.userData={sprite_index:o},this.pointsAr.push(b),n.add(b)}this.scene.add(n)}addBlankHighlightPoints(){let e=new ne.c;this.scene.add(e);let t=[new ne.m(0,0,0)],s=new ne.b,i=t.length;var a=new Float32Array(3*i),r=new Float32Array(2*i);s.addAttribute("position",new ne.a(a,3)),s.addAttribute("offset",new ne.a(r,2));let n=1/this.props.settings.sprite_side,o={texture:{value:this.textures[0]},repeat:{value:new ne.l(n,n)},size:{value:120}};var l=new ne.j({uniforms:o,vertexShader:"\n        attribute vec2 offset;\n        varying vec2 vOffset;\n        uniform float size;\n        void main() {\n          vOffset = offset;\n          gl_PointSize = size;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n        uniform sampler2D texture;\n        uniform vec2 repeat;\n        varying vec2 vOffset;\n        void main() {\n          vec2 uv = vec2( gl_PointCoord.x, gl_PointCoord.y );\n          vec4 tex = texture2D( texture, uv * repeat + vOffset );\n          gl_FragColor = tex;\n        }",transparent:!0});let c=new ne.g(s,l);c.frustumCulled=!1,this.scene.children[1].visible=!1,this.scene.children[1].add(c)}highlightPoint(e,t,s){let{algorithm_choice:i,mappings:a}=this.props,r=this.scene.children[1].children[0],n=a[i][s],o=[new ne.m(n[0],n[1],0)];var l=new Float32Array(2);let c=t%this.props.settings.sprite_side*this.props.settings.sprite_image_size/2048,h=Math.floor(t/this.props.settings.sprite_side)*this.props.settings.sprite_image_size/2048;l[0]=c,l[1]=h,r.geometry.attributes.position.copyVector3sArray(o),r.geometry.attributes.position.needsUpdate=!0,r.geometry.attributes.offset.array=l,r.geometry.attributes.offset.needsUpdate=!0,r.material.uniforms.texture.value=this.textures[e]}removeHighlights(){let e=this.scene.children[1],t=e.children;e.remove(...t)}checkIntersects(e){let{width:t,height:s,previewPane_ctx:i,previewPane_image_size:a}=this.props;let r=function(e){let[i,a]=e;return new ne.m(i/t*2-1,-a/s*2+1,1)}(e);this.raycaster.setFromCamera(r,this.camera),this.raycaster.params.Points.threshold=.25;let n=this.raycaster.intersectObjects(this.scene.children[0].children);if(n[0]){let e=function(e){return F.sortBy(e,"distanceToRay")}(n),t=e[0],s=t.object.userData.sprite_index,r=t.index,l=s*this.sprite_size+r;if(void 0===this.filterAr||this.filterAr[l]<1){this.props.setHoverIndex(l),this.highlightPoint(s,r,l),this.scene.children[1].visible=!0,i.clearRect(0,0,a,a),i.fillRect(0,0,a,a),i.fillStyle="transparent";try{i.drawImage(this.datasetIMG[s],r%this.props.settings.sprite_side*this.props.settings.sprite_image_size,Math.floor(r/this.props.settings.sprite_side)*this.props.settings.sprite_image_size,this.props.settings.sprite_image_size,this.props.settings.sprite_image_size,0,0,a,a)}catch(o){console.log("previewPane_ctx.drawImage",o)}}}else this.props.setHoverIndex(null),this.scene.children[1].visible=!1,i.fillRect(0,0,a,a),i.fillStyle="transparent"}handleMouse(){let e=oe.d(this.renderer.domElement);this.raycaster=new ne.h,e.on("mousemove",(()=>{let[t,s]=oe.b(e.node()),i=[t,s];this.checkIntersects(i)})),e.on("dblclick",(()=>{this.scene.children[1].visible&&this.props.clickOnImage()}))}init(){let{width:e,height:t}=this.props;this.scene=new ne.i;let s=e/t;this.camera=new ne.f(75,s,.01,1e3),this.renderer=new ne.n({preserveDrawingBuffer:!0,alpha:!0}),this.renderer.setClearColor(16777215,0),this.renderer.autoClear=!1,this.renderer.setSize(e,t),this.renderer.domElement.id="threeCanvas",this.mount.appendChild(this.renderer.domElement),this.addPoints(),this.addBlankHighlightPoints(),this.setupCamera(),this.animate(),this.handleMouse(),this.changeEmbeddings(this.props.algorithm_choice)}animate(){requestAnimationFrame(this.animate),le.c(),this.renderer.clear(),0===parseInt(this.props.greyRenderTypeSelected)&&(this.updatePass2Shader(1),this.renderer.render(this.scene,this.camera)),this.updatePass2Shader(2),this.renderer.render(this.scene,this.camera)}componentDidMount(){this.init()}componentDidUpdate(e){let{width:t,height:s}=this.props;t===e.width&&s===e.height||this.handleResize(t,s),e.algorithm_choice!==this.props.algorithm_choice&&this.changeEmbeddings(this.props.algorithm_choice),this.props.scaleMin===e.scaleMin&&this.props.scaleMax===e.scaleMax||this.handleResize(t,s)}componentWillUnmount(){this.mount.removeChild(this.renderer.domElement)}render(){let{width:e,height:t}=this.props;const s=this.state.tilesLoaded,i=this.props.settings.sprite_number;return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("div",{children:s<1?Object(c.jsxs)("div",{className:"loading",children:[Object(c.jsx)(ce.a,{color:"inherit"}),Object(c.jsx)("div",{children:"loading tiles..."})]}):s<i-1?Object(c.jsxs)("div",{className:"loading-small",children:[Object(c.jsx)(ce.a,{color:"inherit"}),Object(c.jsx)("div",{children:"loading..."})]}):""}),Object(c.jsx)("div",{style:{width:e,height:t,overflow:"hidden"},ref:e=>{this.mount=e}})]})}}var de=a.a.memo(he),pe=s(20);class me extends i.Component{constructor(e){super(e),this.calculateProjection=(e,t,s)=>{let i,a,r;"filter"===t&&(this.setState({currentFilter:e}),i=e,a=this.state.currentSearch),"search"===t&&(this.setState({currentSearch:e}),i=this.state.currentFilter,a=e),s?(r=i.map(((e,t)=>e+a[t])),this.setState({currentProjection:r})):r=e;try{this.refProjection.current.updateProjection(r)}catch(n){}},this.toggleControl=()=>{this.setState({collapsedControl:!this.state.collapsedControl})},this.toggleObject=()=>{this.setState({collapsedObject:!this.state.collapsedObject})};let t=this.props.settings.total;this.state={ww:null,wh:null,hover_index:0,previewPane_height:null,controlPane_height:null,filterPane_height:null,algorithm_choice:null,allFilter:{},currentProjection:new Float32Array(t).fill(0),currentFilter:new Float32Array(t).fill(0),currentSearch:new Float32Array(t).fill(0),scaleMin:14,scaleMax:70,filterGrey:!0,clusterTypeSelected:"-",greyRenderTypeSelected:0,dimensions:{},collapsedControl:!1,collapsedObject:!1},this.previewPane_ctx=null,this.setSize=F.debounce(this.setSize.bind(this),200),this.setPreviewPaneCanvas=this.setPreviewPaneCanvas.bind(this),this.setPreviewImage=this.setPreviewImage.bind(this),this.selectAlgorithm=this.selectAlgorithm.bind(this),this.selectDataset=this.selectDataset.bind(this),this.toggleControl=this.toggleControl.bind(this),this.refProjection=a.a.createRef()}componentDidMount(){this.setDefaults(),this.selectAlgorithm(this.props.algorithm_name),this.setSize(),window.addEventListener("resize",this.setSize)}setDefaults(){this.props.settings.total<2e4?this.setState({scaleMin:15,filterGrey:!0,greyRenderTypeSelected:0}):this.setState({scaleMin:5,filterGrey:!1,greyRenderTypeSelected:1})}setRenderer(e){this.setState({renderer:e})}handleChangeScale(e,t){this.setState({scaleMin:t})}handleChangeZoom(e,t){this.setState({scaleMax:t})}handleChangeCluster(e){let t=e.target.value;this.setState({clusterTypeSelected:parseInt(t)}),console.log(e.target);try{this.refProjection.current.updateClusterColors(t)}catch(s){console.log("error updateClusterColors")}}handleChangeGrey(e){this.setState({greyRenderTypeSelected:e})}selectAlgorithm(e){let t=this.props.algorithm_options.indexOf(e);t<0&&(t=0),this.setState({algorithm_choice:t}),this.props.addToUrl("projection",this.props.algorithm_options[t])}selectDataset(e){this.props.changeDataset(e)}setSize(){this.setState({ww:window.innerWidth,wh:window.innerHeight});let e=this.previewPane_mount.offsetHeight;this.setState({previewPane_height:e}),this.previewPane_ctx&&(this.previewPane_ctx.imageSmoothingEnabled=!1),window.innerWidth<900?this.setState({collapsedControl:!0,collapsedObject:!0}):this.setState({collapsedControl:!1,collapsedObject:!1})}setPreviewPaneCanvas(e){let t=e.getContext("2d");t.imageSmoothingEnabled=!1,this.previewPane_ctx=t,console.log(t)}setPreviewImage(){return Object(c.jsx)("img",{src:this.props.settings.url_prefix+this.props.metadata[this.state.hover_index].filename,alt:"preview",style:{verticalAlign:"middle"}})}setHoverIndex(e){null!=e&&this.setState({hover_index:e})}componentWillUnmount(){window.removeEventListener("resize",this.setSize)}clickOnImage(){console.log("open image",this.state.hover_index);try{let e=this.props.metadata[this.state.hover_index].link_URL;window.open(e,"_blank","noopener,noreferrer")}catch(e){}}render(){let{embeddings_data:e,mappings:t,algorithm_options:s,dataset_options:i,metadata:a,settings:r,barData:n}=this.props,{ww:o,wh:l,hover_index:h,algorithm_choice:p,currentProjection:m,allFilter:u,greyRenderTypeSelected:g,clusterTypeSelected:j,collapsedControl:b,collapsedObject:v}=this.state,x=this.previewPane_ctx,f={position:"relative",background:"#111",overflow:"hidden",width:o,height:l},O="320px",y={fontSize:16,lineHeight:1.5},_=0;for(let c=0;c<r.total;c++)0===m[c]&&_++;return null!==o?Object(c.jsxs)("div",{style:y,children:[Object(c.jsx)("div",{style:{position:"absolute",right:0,top:0,height:"auto",maxHeight:"100vh",overflow:"auto",background:"#222",zIndex:8},ref:e=>{this.controlMenu_mount=e},children:Object(c.jsx)("div",{children:Object(c.jsx)(re.c,{collapsed:b,children:Object(c.jsxs)(re.a,{iconShape:"square",children:[Object(c.jsxs)(re.b,{children:[Object(c.jsx)("h3",{}),Object(c.jsx)("a",{className:"collapseCon",onClick:this.toggleControl,children:b?Object(c.jsx)(pe.a,{}):Object(c.jsx)(pe.b,{})})]}),Object(c.jsx)(re.d,{defaultOpen:!0,title:b?null:"Data & Projections",icon:b?Object(c.jsx)(pe.d,{}):null,children:Object(c.jsx)(re.b,{children:Object(c.jsx)(X,{grem:24,algorithm_options:s,algorithm_choice:p,selectAlgorithm:this.selectAlgorithm,dataset_options:i,selectDataset:this.selectDataset,selectedDataset:this.props.selectedDataset,datasetInfo:r.datasetInfo})})}),Object(c.jsx)(re.d,{defaultOpen:!0,title:b?null:"Dimension Filters",icon:b?Object(c.jsx)(pe.j,{}):null,children:Object(c.jsx)(re.b,{children:Object(c.jsx)(k,{grem:24,metadata:a,hover_index:h,settings:r,barData:n,calculateProjection:this.calculateProjection,currentProjection:m,allFilter:u})})}),Object(c.jsx)(re.d,{title:b?null:"Advanced Filters",icon:b?Object(c.jsx)(pe.i,{}):null,children:Object(c.jsx)(re.b,{children:Object(c.jsx)(U,{grem:24,calculateProjection:this.calculateProjection,hover_index:h,settings:r,metadata:a,currentProjection:m,allFilter:u})})}),Object(c.jsx)(re.d,{title:b?null:"Export Filtered Data",icon:b?Object(c.jsx)(pe.c,{}):null,children:Object(c.jsx)(re.b,{children:Object(c.jsx)(ae,{metadata:a,currentProjection:m})})})]})})})}),Object(c.jsx)("div",{style:{position:"absolute",left:0,top:0,height:"auto",maxHeight:"100vh",overflow:"auto",background:"#222",zIndex:8},ref:e=>{this.previewPane_mount=e},children:Object(c.jsx)("div",{children:Object(c.jsx)(re.c,{collapsed:v,children:Object(c.jsxs)(re.a,{iconShape:"square",children:[Object(c.jsxs)(re.b,{children:[v?Object(c.jsx)("h3",{}):Object(c.jsx)("h3",{children:"Collection Space Navigator"}),Object(c.jsx)("a",{className:"collapseObj",onClick:this.toggleObject,children:v?Object(c.jsx)(pe.b,{}):Object(c.jsx)(pe.a,{})})]}),Object(c.jsx)(re.d,{defaultOpen:!0,title:v?null:"Object Preview",icon:v?Object(c.jsx)(pe.h,{}):null,children:Object(c.jsx)(d,{previewPane_image_size:O,setPreviewPaneCanvas:this.setPreviewPaneCanvas,setPreviewImage:this.setPreviewImage,hover_index:h})}),Object(c.jsx)(re.d,{defaultOpen:!0,title:v?null:"Object Info",icon:v?Object(c.jsx)(pe.f,{}):null,children:Object(c.jsx)(re.b,{children:Object(c.jsx)(W,{hover_index:h,metadata:a,infos:r.info})})}),Object(c.jsxs)(re.d,{title:v?null:"Object Appearance",icon:v?Object(c.jsx)(pe.e,{}):null,children:[Object(c.jsx)(re.b,{children:Object(c.jsx)($,{clusters:r.clusters,scaleMin:this.state.scaleMin,scaleMax:this.state.scaleMax,filterGrey:this.state.filterGrey,handleChangeScale:this.handleChangeScale.bind(this),handleChangeZoom:this.handleChangeZoom.bind(this),handleChangeCluster:this.handleChangeCluster.bind(this),handleChangeGrey:this.handleChangeGrey.bind(this),total:r.total})}),Object(c.jsx)(re.b,{children:Object(c.jsxs)("div",{className:"info",children:["showing ",_," / ",r.total]})})]}),Object(c.jsx)(re.d,{title:v?null:"About",icon:v?Object(c.jsx)(pe.g,{}):null,children:Object(c.jsxs)("div",{className:"about",children:["The Collection Space Navigator (CSN) is an ",Object(c.jsx)("strong",{children:"interactive visualization interface for multidimensional datasets"}),". It functions as an explorative visualization tool for researching collections and their multidimensional representations. We designed this tool to better understand multidimensional data, its methods, and semantic qualities through spatial navigation and filtering. CSN can be used with any image collection and can be customized for specific research needs. ",Object(c.jsx)("a",{href:"https://github.com/Collection-Space-Navigator/CSN",target:"_blank",rel:"noreferrer",children:Object(c.jsx)("strong",{children:"[more on GitHub...]"})})]})})]})})})}),Object(c.jsx)("div",{style:f,children:Object(c.jsx)(de,{ref:this.refProjection,width:f.width,height:f.height,embeddings_data:e,mappings:t,metadata:a,previewPane_ctx:x,previewPane_image_size:O,setHoverIndex:this.setHoverIndex.bind(this),algorithm_choice:p,datasetDir:this.props.datasetDir,clusterTypeSelected:j,greyRenderTypeSelected:g,settings:r,initPath:this.props.initPath,scaleMin:this.state.scaleMin,scaleMax:this.state.scaleMax,currentProjection:m,clickOnImage:this.clickOnImage.bind(this)})})]}):Object(c.jsxs)("div",{className:"loading",children:[Object(c.jsx)(ce.a,{color:"inherit"}),Object(c.jsx)("div",{children:"loading layout..."})]})}}var ue=me,ge=s(57),je=s.n(ge);class be extends i.Component{constructor(e){super(e),this.state={algorithm_options:null,dataset_options:null,dataset_dirs:null,embeddings_data:null,mappings:null,metadata:null,defaultDataset:null,algorithm_name:0}}scaleEmbeddings(e){let t=e.map((e=>Math.abs(e[0]))),s=e.map((e=>Math.abs(e[1]))),i=F.max(t),a=F.max(s),r=Math.max(i,a),n=oe.c().domain([-r,r]).range([-20,20]);return e.map((e=>[n(e[0]),n(e[1])]))}componentDidMount(){const e=window.location.search,t=new URLSearchParams(e);this.setState({selectedDataset:t.get("dataset")}),void 0!==t.get("projection")&&this.setState({algorithm_name:t.get("projection")}),this.loadInit("datasets/datasets_config.json")}loadConfig(e){this.loadSettings("datasets/".concat(e,"/config.json")),this.loadBarData("datasets/".concat(e,"/barData.json")),this.loadMetadata("datasets/".concat(e,"/metadata.json"))}prepareMappings(e){let t=[];for(let s in this.state.settings.embeddings)console.log(this.state.settings.embeddings[s].name),t[s]=this.state.settings.embeddings[s].name;this.setState({algorithm_options:t})}loadDataset(e){let t=[];const s=this.state.settings.embeddings;for(let i in s)fetch("".concat("/study-interaction","/datasets/").concat(this.state.datasetDir,"/").concat(s[i].file)).then((e=>e.json())).then((e=>{let s=e;t[i]=s})).then((()=>{this.setState({mappings:t,embeddings_data:t[0]})}))}addToUrl(e,t){const s=window.location.search,i=new URLSearchParams(s);i.set(e,t),this.props.navigate("?"+i.toString())}prepareDatasets(e){let t=[],s=[];for(let i in this.state.settings.embeddings)console.log(this.state.settings.embeddings[i].name),t[i]=this.state.settings.embeddings[i].name,s[i]=this.state.settings.embeddings[i].directory;this.setState({dataset_options:t,dataset_dirs:s})}changeDataset(e){this.addToUrl("dataset",e);let t=this.state.dataset_options.indexOf(e),s=this.state.dataset_dirs[t];this.setState({selectedDataset:e,datasetDir:s,algorithm_options:null,embeddings_data:null,mappings:null,metadata:null}),this.loadConfig(s)}loadInit(e){fetch("".concat("/study-interaction","/")+e).then((e=>e.json())).then((e=>{let t=[],s=[];for(let i in e.data)console.log(e.data[i].directory),t[i]=e.data[i].name,s[i]=e.data[i].directory;if(this.setState({dataset_options:t,dataset_dirs:s}),null===this.state.selectedDataset)this.setState({selectedDataset:e.data[e.default].name,datasetDir:e.data[e.default].directory}),this.addToUrl("dataset",e.data[e.default].name);else{let t=!1;for(let s in e.data)e.data[s].name===this.state.selectedDataset&&(this.setState({datasetDir:e.data[s].directory}),t=!0);t||this.setState({selectedDataset:e.data[e.default].name,datasetDir:e.data[e.default].directory})}})).then((()=>this.loadConfig(this.state.datasetDir)))}loadSettings(e){fetch("".concat("/study-interaction","/")+e).then((e=>e.json())).then((e=>{try{const s=e.clusters.clusterColors.map(i);function i(e){return[je()(e).rgb().array()[0]/255,je()(e).rgb().array()[1]/255,je()(e).rgb().array()[2]/255]}e.clusters.clusterColors=s}catch(t){}this.setState({settings:e})})).then((()=>this.prepareMappings(0))).then((()=>this.loadDataset(0)))}loadMetadata(e){fetch("".concat("/study-interaction","/")+e).then((e=>e.json())).then((e=>this.setState({metadata:e})))}loadBarData(e){fetch("".concat("/study-interaction","/")+e).then((e=>e.json())).then((e=>this.setState({barData:e})))}render(){return this.state.embeddings_data&&this.state.metadata?Object(c.jsx)(ue,{...this.state,addToUrl:this.addToUrl.bind(this),algorithm_name:this.state.algorithm_name,algorithm_options:this.state.algorithm_options,dataset_options:this.state.dataset_options,dataset_dirs:this.state.dataset_dirs,changeDataset:this.changeDataset.bind(this),selectedDataset:this.state.selectedDataset,datasetDir:this.state.datasetDir}):Object(c.jsxs)("div",{className:"loading",children:[Object(c.jsx)(ce.a,{color:"inherit"}),Object(c.jsx)("div",{children:"loading datasets... "})]})}}var ve,xe=(ve=be,e=>Object(c.jsx)(ve,{...e,params:Object(l.q)(),navigate:Object(l.o)()}));function fe(){return Object(c.jsx)(o.a,{children:Object(c.jsxs)(l.c,{children:[Object(c.jsx)(l.a,{exact:!0,path:"/",element:Object(c.jsx)(xe,{})}),Object(c.jsx)(l.a,{exact:!0,path:"/CSN",element:Object(c.jsx)(xe,{})})]})})}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n.a.render(Object(c.jsx)(fe,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((e=>{e.unregister()}))}},[[135,1,2]]]);
//# sourceMappingURL=main.89888434.chunk.js.map