(this["webpackJsonpstudy-interaction"]=this["webpackJsonpstudy-interaction"]||[]).push([[0],{105:function(e,t,s){},106:function(e,t,s){},117:function(e,t,s){},125:function(e,t,s){},134:function(e,t,s){"use strict";s.r(t);var i=s(0),a=s.n(i),n=s(13),r=s.n(n),o=(s(105),s(61)),l=s(6),c=(s(106),s(2));i.Component;var h=s(169),d=(s(173),s(177),s(43),s(168)),p=s(7);const m=12;Object(p.a)((e=>({rail:{backgroundColor:e.palette.grey[400],width:"100%",height:2,position:"absolute",pointerEvents:"none"},railHotspot:{width:"100%",height:24,top:-12,position:"absolute",cursor:"pointer"}})))((function(e){let{classes:t,getRailProps:s}=e;return Object(c.jsxs)(i.Fragment,{children:[Object(c.jsx)("div",{className:t.railHotspot,...s()}),Object(c.jsx)("div",{className:t.rail})]})}));Object(p.a)((e=>({root:{backgroundColor:e.palette.secondary.main,marginLeft:-6,marginTop:-6,width:m,height:m,border:0,borderRadius:"50%",whiteSpace:"nowrap",position:"absolute",zIndex:2,cursor:"pointer"}})))((function(e){let{domain:[t,s],handle:{id:i,value:a,percent:n},classes:r,getHandleProps:o}=e;return Object(c.jsx)("div",{role:"slider","aria-valuemin":t,"aria-valuemax":s,"aria-valuenow":a,className:r.root,style:{left:"".concat(n,"%")},...o(i)})}));Object(p.a)((e=>({track:{backgroundColor:e.palette.secondary.main,height:2,position:"absolute",zIndex:1,pointerEvents:"none"},trackHotspot:{height:m,top:-6,position:"absolute",cursor:"pointer"}})))((function(e){let{classes:t,source:s,target:a,getTrackProps:n}=e;const r="".concat(s.percent,"%"),o="".concat(a.percent-s.percent,"%");return Object(c.jsxs)(i.Fragment,{children:[Object(c.jsx)("div",{className:t.track,style:{left:r,width:o}}),Object(c.jsx)("div",{className:t.trackHotspot,style:{left:r,width:o},...n()})]})}));function g(e){let{classes:t,tick:s,count:i,format:a}=e;return Object(c.jsxs)("div",{children:[Object(c.jsx)("div",{className:t.tick,style:{left:"".concat(s.percent,"%")}}),Object(c.jsx)(d.a,{className:t.label,variant:"caption",style:{marginLeft:"".concat(-100/i/2,"%"),width:"".concat(100/i,"%"),left:"".concat(s.percent,"%")},children:a(s.value)})]})}g.defaultProps={format:e=>e};Object(p.a)((e=>({tick:{position:"absolute",marginTop:14,width:1,height:5,backgroundColor:e.palette.grey[400]},label:{position:"absolute",marginTop:22,textAlign:"center"}})))(g);s(64);a.a.Component;a.a.Component;i.Component;i.Component;var u=s(18),b=(s(171),s(136),s(62));s(117);b.SimpleResultProcessing;i.Component;i.Component;s(63);i.Component;i.Component;s(175),s(178);i.Component;const f="https://script.google.com/macros/s/AKfycbzihNMsNv0ENe24M9mitXiZurl2DOHXK1RMR5AX0v0lC9RP5WXhyLTNnxg7J6sTALNZ6A/exec";class v extends i.Component{constructor(e){super(e),this.state={isInputFilled:!1,isRadioSelected:!1,buttonEnabled:!1,exploredMaps:[],alleExplored:!1,explorationMode:!0,mapLabels:["","",""],mapConfidences:["","",""]},this.handleSelectAlgorithm=this.handleSelectAlgorithm.bind(this),this.handleSelectDataset=this.handleSelectDataset.bind(this)}componentDidMount(){this.props.algorithm_options.length>0&&this.setState({exploredMaps:[this.props.algorithm_options[0]]});const e=(new Date).toLocaleString();this.exportLog({target:{timestamp:e,message:"start exploration",mapID:this.props.algorithm_options[this.props.algorithm_choice]}})}handleSelectAlgorithm(e){let t=e.target.value;if(console.log("algorithm",t),this.props.selectAlgorithm(t),this.state.exploredMaps.includes(t)||this.setState((e=>{let s=[...e.exploredMaps,t];return{exploredMaps:s,alleExplored:s.length===this.props.algorithm_options.length}})),console.log("alleExplored",this.state.alleExplored),this.state.explorationMode){const e=(new Date).toLocaleString(),s="switch map to ".concat(t);this.exportLog({target:{timestamp:e,message:s,mapID:this.props.algorithm_options[this.props.algorithm_choice]}})}}componentDidUpdate(e){this.props.algorithm_choice!==e.algorithm_choice&&this.setState((e=>{let t=e.mapConfidences[this.props.algorithm_choice];if(console.log("confidenceValue",t),""===t){document.querySelectorAll('input[name="confidence"]').forEach((e=>{e.checked=!1}))}else{let e=document.querySelector('input[name="confidence"][value="'.concat(t,'"]'));e&&(e.checked=!0)}return e}))}handleSelectDataset(e){let t=e.target.value;this.props.selectDataset(t)}handleInput(e){let t=e.target.value;this.setState((e=>{let s=[...e.mapLabels,t];return{isInputFilled:t.length>3,mapLabels:s}})),this.state.isInputFilled&&this.state.isRadioSelected?this.setState({buttonEnabled:!0}):this.setState({buttonEnabled:!1}),this.setState((s=>{let i=[...s.mapLabels];return i[e.target.map]=t,{mapLabels:i}}))}handleRadio(e){let t=e.target.value;this.setState((e=>{let s={...e.mapConfidences};return s[this.props.algorithm_choice]=t,{isRadioSelected:!0,mapConfidences:s}})),this.state.isInputFilled?this.setState({buttonEnabled:!0}):this.setState({buttonEnabled:!1})}handleNext(){this.props.algorithm_choice+1<this.props.algorithm_options.length?this.handleSelectAlgorithm({target:{value:this.props.algorithm_options[this.props.algorithm_choice+1]}}):window.open("https://tillmannohm.github.io/study-annotation/?id=".concat(this.props.participantId,"&dataset=").concat(this.props.selectedDataset),"_self")}handleFinish(){this.setState({explorationMode:!1}),console.log("explorationMode",this.state.explorationMode),this.handleSelectAlgorithm({target:{value:this.props.algorithm_options[0]}})}exportLog(e){console.log("export log");const t=new FormData;t.append("sheetName","log"),t.append("timestamp",e.target.timestamp),t.append("userID",this.props.participantId),t.append("message",e.target.message),t.append("mapID",e.target.mapID),fetch(f,{method:"POST",body:t}).then((e=>e.json())).then((e=>{"success"===e.result?console.log("Data submitted successfully"):(console.log("Failed to submit data"),console.log(e))})).catch((e=>console.error("Error:",e)))}exportLabels(e){const t=new FormData;t.append("sheetName","labels"),t.append("userID",this.props.participantId),t.append("timestamp",Date.now()),t.append("mapID",e.target.map),t.append("label",e.target.value),t.append("confidence",e.target.confidence),fetch(f,{method:"POST",body:t}).then((e=>e.json())).then((e=>{"success"===e.result?console.log("Data submitted successfully"):console.log("Failed to submit data")})).catch((e=>console.error("Error:",e)))}render(){let{algorithm_options:e,algorithm_choice:t,selectedDataset:s}=this.props;return Object(c.jsxs)(h.a,{container:!0,spacing:1,children:[Object(c.jsxs)(h.a,{item:!0,xs:12,children:[Object(c.jsx)("h1",{children:"2/4: Interactive Maps"}),this.state.explorationMode?Object(c.jsx)("h3",{children:"Make yourself familiar with the collection and try to understand the ideas behind the different maps"}):Object(c.jsx)("h3",{children:"Please fill out the form for each map"})]}),Object(c.jsxs)(h.a,{item:!0,xs:12,children:[Object(c.jsxs)("h2",{children:["Map ",e[t]]}),Object(c.jsx)("p",{children:"Switch between different maps:"})]}),Object(c.jsx)("div",{children:Object(c.jsx)(h.a,{item:!0,xs:12,children:Object(c.jsx)("div",{style:{display:"flex",justifyContent:"space-between"},children:e.map(((s,i)=>Object(c.jsx)("div",{children:Object(c.jsx)("button",{type:"button",style:{backgroundColor:e[t]===s?"#808080":"#4CAF50",color:e[t]===s?"darkgrey":"white",cursor:e[t]===s?"default":"pointer"},className:e[t]===s?"selected":"",onClick:()=>this.handleSelectAlgorithm({target:{value:s}}),children:s})},s)))})})}),this.state.explorationMode?Object(c.jsxs)("div",{children:[Object(c.jsx)(h.a,{item:!0,xs:12,children:Object(c.jsx)("p",{children:"Once you feel ready continue:"})}),Object(c.jsx)(h.a,{item:!0,xs:12,children:Object(c.jsx)("button",{style:{backgroundColor:this.state.alleExplored?"#4CAF50":"#808080",color:this.state.alleExplored?"white":"darkgray",cursor:this.state.alleExplored?"pointer":"not-allowed"},onClick:()=>{this.handleFinish()},children:"ready"})})]}):Object(c.jsxs)("div",{children:[Object(c.jsx)(h.a,{item:!0,xs:12,children:Object(c.jsx)("p",{children:"Give a meaningful label to describe the underlying similarity concept of this map:"})}),Object(c.jsx)(h.a,{item:!0,xs:12,children:Object(c.jsx)("input",{type:"text",className:"full-width",id:"labelInput",placeholder:"Enter a descriptive label",value:this.state.mapLabels[this.props.algorithm_choice]||"",onChange:e=>{this.handleInput({target:{value:e.target.value,map:this.props.algorithm_choice}})}})}),Object(c.jsx)(h.a,{item:!0,xs:12,children:Object(c.jsx)("p",{children:"I am confident about my answer and found the underlying similarity concept easy to describe."})}),Object(c.jsx)(h.a,{item:!0,xs:12,children:Object(c.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[Object(c.jsxs)("div",{style:{width:"20%"},children:[Object(c.jsxs)("p",{style:{fontSize:"small",transform:"rotate(-45deg)"},children:["Strongly",Object(c.jsx)("br",{}),"Disagree"]}),Object(c.jsx)("input",{type:"radio",id:"1",name:"confidence",value:"1",onChange:e=>{this.handleRadio(e)}})]}),Object(c.jsxs)("div",{style:{width:"20%"},children:[Object(c.jsxs)("p",{style:{fontSize:"small",transform:"rotate(-45deg)"},children:["\xa0",Object(c.jsx)("br",{}),"Disagree"]}),Object(c.jsx)("input",{type:"radio",id:"2",name:"confidence",value:"2",onChange:e=>{this.handleRadio(e)}})]}),Object(c.jsxs)("div",{style:{width:"20%"},children:[Object(c.jsxs)("p",{style:{fontSize:"small",transform:"rotate(-45deg)"},children:["\xa0",Object(c.jsx)("br",{}),"Neutral"]}),Object(c.jsx)("input",{type:"radio",id:"3",name:"confidence",value:"3",onChange:e=>{this.handleRadio(e)}})]}),Object(c.jsxs)("div",{style:{width:"20%"},children:[Object(c.jsxs)("p",{style:{fontSize:"small",transform:"rotate(-45deg)"},children:["\xa0",Object(c.jsx)("br",{}),"Agree"]}),Object(c.jsx)("input",{type:"radio",id:"4",name:"confidence",value:"4",onChange:e=>{this.handleRadio(e)}})]}),Object(c.jsxs)("div",{style:{width:"20%"},children:[Object(c.jsxs)("p",{style:{fontSize:"small",transform:"rotate(-45deg)"},children:["Strongly",Object(c.jsx)("br",{}),"Agree"]}),Object(c.jsx)("input",{type:"radio",id:"5",name:"confidence",value:"5",onChange:e=>{this.handleRadio(e)}})]})]})}),Object(c.jsx)(h.a,{item:!0,xs:12,children:Object(c.jsx)("p",{})}),Object(c.jsx)(h.a,{item:!0,xs:12,children:Object(c.jsx)("button",{style:{backgroundColor:this.state.buttonEnabled?"#4CAF50":"#808080",color:this.state.buttonEnabled?"white":"darkgray",cursor:this.state.buttonEnabled?"pointer":"not-allowed"},onClick:()=>{const s=document.getElementById("labelInput").value;""!==s&&(this.exportLabels({target:{value:s,map:e[t],confidence:document.querySelector('input[name="confidence"]:checked').value}}),this.handleNext())},disabled:!this.state.buttonEnabled,children:"submit"})})]})]})}}var j=a.a.memo(v);s(78),s(79);i.Component;var x=s(53),y=(s(125),s(12)),_=s(22),w=s(54),O=s(172);class S extends i.Component{constructor(e){super(e),this.handleResize=(e,t)=>{this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t);let s=this.getScaleFromZ(this.camera.position.z),i=-this.camera.position.x*s+this.props.width/2,a=this.camera.position.y*s+this.props.height/2;var n=_.f.translate(i,a).scale(s);let r=_.d(this.mount);this.d3_zoom.transform(r,n)},this.updateProjection=e=>{this.filterAr=e;let t=[],s=[];for(let i=0;i<this.props.settings.sprite_number;i++){let a=i*this.sprite_size,n=(i+1)*this.sprite_size;i===this.props.settings.sprite_number-1&&(n=this.props.settings.sprite_number*this.sprite_size),t.push([a,n]),s.push(e.slice(a,n))}for(let i=0;i<this.props.settings.sprite_number;i++){let e=this.scene.children[0].children[i];e.geometry.attributes.filteredActive=new y.a(s[i],1),e.geometry.attributes.filteredActive.needsUpdate=!0}},this.updatePass2Shader=e=>{for(let t=0;t<this.props.settings.sprite_number;t++){let s=this.scene.children[0].children[t];1===e&&(s.material.uniforms.greyTransparency.value=.1,s.material.uniforms.greyTransparency.needsUpdate=!0,s.material.uniforms.imageTransparency.value=1,s.material.uniforms.imageTransparency.needsUpdate=!0),2===e&&(s.material.uniforms.greyTransparency.value=0,s.material.uniforms.greyTransparency.needsUpdate=!0,s.material.uniforms.imageTransparency.value=0,s.material.uniforms.imageTransparency.needsUpdate=!0)}},this.updateClusterColors=e=>{let t=this.props.metadata.length,s=new Float32Array(3*t),i=this.props.settings.clusters.clusterColors,a=[],n=[];if("disabled"!==e){let r=[];for(let a=0,n=0,o=t;a<o;a++,n+=1){let t=this.props.metadata[n][e];-1===r.indexOf(t)&&r.push(t);let a=r.indexOf(t);a>=i.length?(s[3*n]=Math.random(),s[3*n+1]=Math.random(),s[3*n+2]=Math.random()):(s[3*n]=i[a][0],s[3*n+1]=i[a][1],s[3*n+2]=i[a][2])}for(let e=0;e<this.props.settings.sprite_number;e++){let t=e*this.sprite_size,i=(e+1)*this.sprite_size;e===this.props.settings.sprite_number-1&&(i=this.props.settings.sprite_number*this.sprite_size),a.push([t,i]),n.push(s.slice(3*t,3*i))}}for(let r=0;r<this.props.settings.sprite_number;r++){let t=this.scene.children[0].children[r];"disabled"!==e?(t.geometry.attributes.cluster=new y.a(n[r],3),t.geometry.attributes.cluster.needsUpdate=!0,t.material.uniforms.clusterActive.value=1,t.material.uniforms.clusterActive.needsUpdate=!0):(t.material.uniforms.clusterActive.value=0,t.material.uniforms.clusterActive.needsUpdate=!0)}},this.loadTiles(),this.state={tilesLoaded:0,view:null},this.init=this.init.bind(this),this.pointsAr=[],this.addPoints=this.addPoints.bind(this),this.handleResize=this.handleResize.bind(this),this.setupCamera=this.setupCamera.bind(this),this.animate=this.animate.bind(this),this.getScaleFromZ=this.getScaleFromZ.bind(this),this.getZFromScale=this.getZFromScale.bind(this),this.changeEmbeddings=this.changeEmbeddings.bind(this)}loadTiles(){this.sprite_size=this.props.settings.sprite_side*this.props.settings.sprite_side,this.tile_locations=[...Array(this.props.settings.sprite_number)].map(((e,t)=>"".concat("/study-interaction","/datasets/").concat(this.props.settings.sprite_dir,"/tile_").concat(t,".png"))),this.datasetIMG=this.tile_locations.map((e=>{let t=document.createElement("img");return t.src=e,t}))}changeEmbeddings(e){let t=[];for(let i=0;i<this.props.settings.sprite_number;i++){let e=i*this.sprite_size,s=(i+1)*this.sprite_size;i===this.props.settings.sprite_number-1&&(s=this.props.settings.sprite_number*this.sprite_size),t.push([e,s])}let s=t.map((t=>this.props.mappings[e].slice(t[0],t[1])));for(let i=0;i<this.props.settings.sprite_number;i++){let e=s[i],t=this.scene.children[0].children[i],a=e.length,n=t.geometry.attributes.position.array,r=new Float32Array(3*a);for(let s=0,i=0,l=a;s<l;s++,i+=3){let t=e[s][0],a=e[s][1],n=0;r[i]=t,r[i+1]=a,r[i+2]=n}let o=new w.b(n).to(r,1e3).easing(w.a.Linear.None);o.onUpdate((function(){t.geometry.attributes.position=new y.a(n,3),t.geometry.attributes.position.needsUpdate=!0})),o.start()}}zoomScaler(e){return _.c().domain([20,0]).range([this.props.scaleMin,this.props.scaleMax]).clamp(!0)(e)}getZFromScale(e){let t=y.d.degToRad(this.camera.fov);return this.props.height/e/(2*Math.tan(t/2))}getScaleFromZ(e){let t=y.d.degToRad(this.camera.fov),s=2*(Math.tan(t/2)*e);return this.props.height/s}zoomHandler(){let e=_.a.transform,t=e.k,s=-(e.x-this.props.width/2)/t,i=(e.y-this.props.height/2)/t,a=this.getZFromScale(t);this.camera.position.set(s,i,a);let n=this.zoomScaler(a),r=this.scene.children[0].children;for(let o=0;o<r.length;o++)r[o].material.uniforms.size.value=n}setupCamera(){let e,{width:t,height:s,embeddings_data:i}=this.props,a=this.camera.fov,n=y.d.degToRad(a),r=i.map((e=>e[0])),o=u.min(r),l=u.max(r),c=i.map((e=>e[1])),h=u.min(c),d=u.max(c),p=u.max([o,l].map((e=>Math.abs(e)))),m=u.max([h,d].map((e=>Math.abs(e))));e=Math.max(p,m)/Math.tan(n/2);let g=1.25*e;this.camera.far=g,this.camera.position.z=1.1*e,this.d3_zoom=_.e().scaleExtent([this.getScaleFromZ(g-1),this.getScaleFromZ(.1)]).on("zoom",this.zoomHandler.bind(this));let b=_.d(this.mount);this.view=b,b.call(this.d3_zoom);let f=this.getScaleFromZ(this.camera.position.z);var v=_.f.translate(t/2,s/2).scale(f);this.d3_zoom.transform(b,v),this.setState({view:b})}addPoints(){let{embeddings_data:e,metadata:t}=this.props,s=[];for(let o=0;o<this.props.settings.sprite_number;o++){let e=o*this.sprite_size,t=(o+1)*this.sprite_size;o===this.props.settings.sprite_number-1&&(t=this.props.settings.sprite_number*this.sprite_size),s.push([e,t])}let i,a=s.map((t=>e.slice(t[0],t[1]))),n=new y.k;this.textures=this.tile_locations.map((e=>{let t=n.load(e,function(e){this.setState({tilesLoaded:this.state.tilesLoaded+1})}.bind(this));return t.flipY=!1,t.magFilter=y.e,t}));let r=new y.c;for(let o=0;o<this.props.settings.sprite_number;o++){let e=a[o],s=[];for(let t=0;t<e.length;t++){let i=e[t],a=new y.m(i[0],i[1],0);s[t]=a}i=new y.b;let n=s.length,l=new Float32Array(3*n),c=new Float32Array(2*n),h=new Float32Array(3*n),d=new Float32Array(n);i.addAttribute("position",new y.a(l,3)),i.addAttribute("offset",new y.a(c,2)),i.addAttribute("filter",new y.a(d,1)),i.addAttribute("cluster",new y.a(h,3));for(let t=0,i=0,a=n;t<a;t++,i+=3){let s=e[t][0],a=e[t][1],n=0;l[i]=s,l[i+1]=a,l[i+2]=n}let p=1/this.props.settings.sprite_side;for(let t=0,i=0,a=n;t<a;t++,i+=2){let e=t%this.props.settings.sprite_side*this.props.settings.sprite_image_size/this.props.settings.sprite_actual_size,s=Math.floor(t/this.props.settings.sprite_side)*this.props.settings.sprite_image_size/this.props.settings.sprite_actual_size;c[i]=e,c[i+1]=s}if(this.props.settings.clusters.clusterList){let e=this.props.clusterTypeSelected,s=this.props.settings.clusters.clusterColors;for(let i=0,a=0,r=n;i<r;i++,a+=1)if(d[a]=0,"-"!==e&&this.props.settings.clusters.clusterList.includes(e)){let i=t[a][e];i>=s.length?(h[3*a]=1,h[3*a+1]=1,h[3*a+2]=1):(h[3*a]=s[i][0],h[3*a+1]=s[i][1],h[3*a+2]=s[i][2])}}let m={texture:{value:this.textures[o]},repeat:{value:new y.l(p,p)},size:{value:this.props.settings.sprite_image_size},greyTransparency:{value:.1},imageTransparency:{value:1},clusterActive:{value:0}},g="\n        attribute vec2 offset;\n        varying vec2 vOffset;\n        attribute vec3 cluster;\n        varying vec3 vCluster;\n        attribute float filteredActive;\n        varying float vFilteredActive;\n        uniform float clusterActive;\n        varying float vClusterActive;\n        uniform float size;\n        uniform float greyTransparency;\n        varying float vGreyTransparency;\n        uniform float imageTransparency;\n        varying float vImageTransparency;\n\n        void main() {\n          vOffset = offset;\n          vFilteredActive = filteredActive;\n          vCluster = cluster;\n          vClusterActive = clusterActive;\n          vGreyTransparency = greyTransparency;\n          vImageTransparency = imageTransparency;\n          gl_PointSize = size;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",u="\n        uniform sampler2D texture;\n        uniform vec2 repeat;\n        varying vec2 vOffset;\n        varying vec3 vCluster;\n        varying float vClusterActive;\n        varying float vFilteredActive;\n        varying float vGreyTransparency;\n        varying float vImageTransparency;\n        void main() {\n          vec2 uv = vec2( gl_PointCoord.x, gl_PointCoord.y );\n          vec4 tex = texture2D( texture, uv * repeat + vOffset );\n          // make transparent images\n          if ( tex.a < 0.003 ) discard;\n\n          // Display clusters\n          vec4 replace_color = vec4(vCluster,1.0);\n          vec4 default_border_color = vec4(0.00392156863,0.00392156863,0.00392156863,0.0);\n          vec4 diff = tex - default_border_color;\n          float equality = float(dot(diff,diff) < 0.99 && vClusterActive > 0.9);\n          tex = mix( tex, replace_color, equality);\n           \n          // make transparent images\n          tex = mix( tex,  vec4(0.0,0.0,0.0,0.0), vImageTransparency);\n\n          // Grey images filter our selection \n          vec4 filterout_color = vec4(0.3,0.3,0.3,vGreyTransparency);\n          float filterout_equality = float(vFilteredActive > 0.9);\n          tex = mix( tex, filterout_color, filterout_equality );\n          gl_FragColor = tex; //* vec4(vColor, 1.0);\n        }",b=new y.j({uniforms:m,vertexShader:g,fragmentShader:u,transparent:!0}),f=new y.g(i,b);f.userData={sprite_index:o},this.pointsAr.push(f),r.add(f)}this.scene.add(r)}addBlankHighlightPoints(){let e=new y.c;this.scene.add(e);let t=[new y.m(0,0,0)],s=new y.b,i=t.length;var a=new Float32Array(3*i),n=new Float32Array(2*i);s.addAttribute("position",new y.a(a,3)),s.addAttribute("offset",new y.a(n,2));let r=1/this.props.settings.sprite_side,o={texture:{value:this.textures[0]},repeat:{value:new y.l(r,r)},size:{value:156}};var l=new y.j({uniforms:o,vertexShader:"\n        attribute vec2 offset;\n        varying vec2 vOffset;\n        uniform float size;\n        void main() {\n          vOffset = offset;\n          gl_PointSize = size;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n        uniform sampler2D texture;\n        uniform vec2 repeat;\n        varying vec2 vOffset;\n        void main() {\n          vec2 uv = vec2( gl_PointCoord.x, gl_PointCoord.y );\n          vec4 tex = texture2D( texture, uv * repeat + vOffset );\n          gl_FragColor = tex;\n        }",transparent:!0});let c=new y.g(s,l);c.frustumCulled=!1,this.scene.children[1].visible=!1,this.scene.children[1].add(c)}highlightPoint(e,t,s){let{algorithm_choice:i,mappings:a}=this.props,n=this.scene.children[1].children[0],r=a[i][s],o=[new y.m(r[0],r[1],0)];var l=new Float32Array(2);let c=t%this.props.settings.sprite_side*this.props.settings.sprite_image_size/2048,h=Math.floor(t/this.props.settings.sprite_side)*this.props.settings.sprite_image_size/2048;l[0]=c,l[1]=h,n.geometry.attributes.position.copyVector3sArray(o),n.geometry.attributes.position.needsUpdate=!0,n.geometry.attributes.offset.array=l,n.geometry.attributes.offset.needsUpdate=!0,n.material.uniforms.texture.value=this.textures[e]}removeHighlights(){let e=this.scene.children[1],t=e.children;e.remove(...t)}checkIntersects(e){let{width:t,height:s,previewPane_ctx:i,previewPane_image_size:a}=this.props;let n=function(e){let[i,a]=e;return new y.m(i/t*2-1,-a/s*2+1,1)}(e);this.raycaster.setFromCamera(n,this.camera),this.raycaster.params.Points.threshold=.25;let r=this.raycaster.intersectObjects(this.scene.children[0].children);if(r[0]){let e=function(e){return u.sortBy(e,"distanceToRay")}(r),t=e[0],s=t.object.userData.sprite_index,i=t.index,a=s*this.sprite_size+i;(void 0===this.filterAr||this.filterAr[a]<1)&&(this.props.setHoverIndex(a),this.highlightPoint(s,i,a),this.scene.children[1].visible=!0)}else this.props.setHoverIndex(null),this.scene.children[1].visible=!1}handleMouse(){let e=_.d(this.renderer.domElement);this.raycaster=new y.h,e.on("mousemove",(()=>{let[t,s]=_.b(e.node()),i=[t,s];this.checkIntersects(i)})),e.on("dblclick",(()=>{this.scene.children[1].visible&&this.props.clickOnImage()}))}init(){let{width:e,height:t}=this.props;this.scene=new y.i;let s=e/t;this.camera=new y.f(75,s,.01,1e3),this.renderer=new y.n({preserveDrawingBuffer:!0,alpha:!0}),this.renderer.setClearColor(16777215,0),this.renderer.autoClear=!1,this.renderer.setSize(e,t),this.renderer.domElement.id="threeCanvas",this.mount.appendChild(this.renderer.domElement),this.addPoints(),this.addBlankHighlightPoints(),this.setupCamera(),this.animate(),this.handleMouse(),this.changeEmbeddings(this.props.algorithm_choice)}animate(){requestAnimationFrame(this.animate),w.c(),this.renderer.clear(),0===parseInt(this.props.greyRenderTypeSelected)&&(this.updatePass2Shader(1),this.renderer.render(this.scene,this.camera)),this.updatePass2Shader(2),this.renderer.render(this.scene,this.camera)}componentDidMount(){this.init()}componentDidUpdate(e){let{width:t,height:s}=this.props;t===e.width&&s===e.height||this.handleResize(t,s),e.algorithm_choice!==this.props.algorithm_choice&&this.changeEmbeddings(this.props.algorithm_choice),this.props.scaleMin===e.scaleMin&&this.props.scaleMax===e.scaleMax||this.handleResize(t,s)}componentWillUnmount(){this.mount.removeChild(this.renderer.domElement)}render(){let{width:e,height:t}=this.props;const s=this.state.tilesLoaded,i=this.props.settings.sprite_number;return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("div",{children:s<1?Object(c.jsxs)("div",{className:"loading",children:[Object(c.jsx)(O.a,{color:"inherit"}),Object(c.jsx)("div",{children:"loading tiles..."})]}):s<i-1?Object(c.jsxs)("div",{className:"loading-small",children:[Object(c.jsx)(O.a,{color:"inherit"}),Object(c.jsx)("div",{children:"loading..."})]}):""}),Object(c.jsx)("div",{style:{width:e,height:t,overflow:"hidden"},ref:e=>{this.mount=e}})]})}}var C=a.a.memo(S);class D extends i.Component{constructor(e){super(e),this.calculateProjection=(e,t,s)=>{let i,a,n;"filter"===t&&(this.setState({currentFilter:e}),i=e,a=this.state.currentSearch),"search"===t&&(this.setState({currentSearch:e}),i=this.state.currentFilter,a=e),s?(n=i.map(((e,t)=>e+a[t])),this.setState({currentProjection:n})):n=e;try{this.refProjection.current.updateProjection(n)}catch(r){}},this.toggleControl=()=>{this.setState({collapsedControl:!this.state.collapsedControl})},this.toggleObject=()=>{this.setState({collapsedObject:!this.state.collapsedObject})};let t=this.props.settings.total;this.state={ww:null,wh:null,hover_index:0,previewPane_height:null,controlPane_height:null,filterPane_height:null,algorithm_choice:null,allFilter:{},currentProjection:new Float32Array(t).fill(0),currentFilter:new Float32Array(t).fill(0),currentSearch:new Float32Array(t).fill(0),scaleMin:14,scaleMax:70,filterGrey:!0,clusterTypeSelected:"-",greyRenderTypeSelected:0,dimensions:{},collapsedControl:!1,collapsedObject:!1},this.previewPane_ctx=null,this.setSize=u.debounce(this.setSize.bind(this),200),this.setPreviewPaneCanvas=this.setPreviewPaneCanvas.bind(this),this.setPreviewImage=this.setPreviewImage.bind(this),this.selectAlgorithm=this.selectAlgorithm.bind(this),this.selectDataset=this.selectDataset.bind(this),this.toggleControl=this.toggleControl.bind(this),this.refProjection=a.a.createRef()}componentDidMount(){this.setDefaults(),this.selectAlgorithm(this.props.algorithm_name),this.setSize(),window.addEventListener("resize",this.setSize)}setDefaults(){this.setState({scaleMin:35,filterGrey:!1,greyRenderTypeSelected:1})}setRenderer(e){this.setState({renderer:e})}handleChangeScale(e,t){this.setState({scaleMin:t})}handleChangeZoom(e,t){this.setState({scaleMax:t})}handleChangeCluster(e){let t=e.target.value;this.setState({clusterTypeSelected:parseInt(t)});try{this.refProjection.current.updateClusterColors(t)}catch(s){console.log("error updateClusterColors")}}handleChangeGrey(e){this.setState({greyRenderTypeSelected:e})}selectAlgorithm(e){let t=this.props.algorithm_options.indexOf(e);t<0&&(t=0),this.setState({algorithm_choice:t})}selectDataset(e){this.props.changeDataset(e)}setSize(){this.setState({ww:window.innerWidth,wh:window.innerHeight});let e=this.previewPane_mount.offsetHeight;this.setState({previewPane_height:e}),this.previewPane_ctx&&(this.previewPane_ctx.imageSmoothingEnabled=!1),window.innerWidth<900?this.setState({collapsedControl:!0,collapsedObject:!0}):this.setState({collapsedControl:!1,collapsedObject:!1})}setPreviewPaneCanvas(e){let t=e.getContext("2d");t.imageSmoothingEnabled=!1,this.previewPane_ctx=t}setPreviewImage(){return Object(c.jsx)("img",{src:this.props.settings.url_prefix+this.props.metadata[this.state.hover_index].filename,alt:"preview",style:{verticalAlign:"middle"}})}setHoverIndex(e){null!=e&&this.setState({hover_index:e})}componentWillUnmount(){window.removeEventListener("resize",this.setSize)}clickOnImage(){try{let e=this.props.metadata[this.state.hover_index].link_URL;window.open(e,"_blank","noopener,noreferrer")}catch(e){}}render(){let{embeddings_data:e,mappings:t,algorithm_options:s,dataset_options:i,metadata:a,settings:n,barData:r}=this.props,{ww:o,wh:l,hover_index:h,algorithm_choice:d,currentProjection:p,allFilter:m,greyRenderTypeSelected:g,clusterTypeSelected:u,collapsedControl:b,collapsedObject:f}=this.state,v=(this.previewPane_ctx,{position:"relative",background:"#a4a4a4",overflow:"hidden",width:o,height:l}),y={fontSize:16,lineHeight:1.5};for(let c=0;c<n.total;c++)0===p[c]&&0;return null!==o?Object(c.jsxs)("div",{style:y,children:[Object(c.jsx)("div",{style:{position:"absolute",right:0,top:0,height:"auto",maxHeight:"100vh",overflow:"auto",background:"#a4a4a4",zIndex:8},ref:e=>{this.controlMenu_mount=e},children:Object(c.jsx)("div",{children:Object(c.jsx)(x.c,{collapsed:b,children:Object(c.jsx)(x.a,{children:Object(c.jsx)(x.b,{children:Object(c.jsx)(j,{grem:24,algorithm_options:s,algorithm_choice:d,selectAlgorithm:this.selectAlgorithm,dataset_options:i,selectDataset:this.selectDataset,selectedDataset:this.props.selectedDataset,participantId:this.props.participantId,datasetInfo:n.datasetInfo})})})})})}),Object(c.jsx)("div",{style:{position:"absolute",left:0,top:0,height:"auto",maxHeight:"100vh",overflow:"auto",background:"#a4a4a4",zIndex:8},ref:e=>{this.previewPane_mount=e}}),Object(c.jsx)("div",{style:v,children:Object(c.jsx)(C,{ref:this.refProjection,width:v.width,height:v.height,embeddings_data:e,mappings:t,metadata:a,setHoverIndex:this.setHoverIndex.bind(this),algorithm_choice:d,datasetDir:this.props.datasetDir,clusterTypeSelected:u,greyRenderTypeSelected:g,settings:n,initPath:this.props.initPath,scaleMin:this.state.scaleMin,scaleMax:this.state.scaleMax,currentProjection:p,clickOnImage:this.clickOnImage.bind(this)})})]}):Object(c.jsxs)("div",{className:"loading",children:[Object(c.jsx)(O.a,{color:"inherit"}),Object(c.jsx)("div",{children:"loading layout..."})]})}}var A=D,z=s(55),P=s.n(z);class M extends i.Component{constructor(e){super(e),this.state={algorithm_options:null,dataset_options:null,dataset_dirs:null,embeddings_data:null,mappings:null,metadata:null,defaultDataset:null,algorithm_name:0,participantId:null}}scaleEmbeddings(e){let t=e.map((e=>Math.abs(e[0]))),s=e.map((e=>Math.abs(e[1]))),i=u.max(t),a=u.max(s),n=Math.max(i,a),r=_.c().domain([-n,n]).range([-20,20]);return e.map((e=>[r(e[0]),r(e[1])]))}componentDidMount(){const e=window.location.search,t=new URLSearchParams(e),s=t.get("id");if(s)this.setState({participantId:s});else{let e;do{e=prompt("Please enter your participant ID:")}while(!e||e.length<5);this.setState({participantId:e})}this.setState({selectedDataset:t.get("dataset")}),this.loadInit("datasets/datasets_config.json")}loadConfig(e){this.loadSettings("datasets/".concat(e,"/config.json")),this.loadBarData("datasets/".concat(e,"/barData.json")),this.loadMetadata("datasets/".concat(e,"/metadata.json"))}prepareMappings(e){let t=[];for(let s in this.state.settings.embeddings)console.log(this.state.settings.embeddings[s].name),t[s]=this.state.settings.embeddings[s].name;this.setState({algorithm_options:t})}loadDataset(e){let t=[];const s=this.state.settings.embeddings;for(let i in s)fetch("".concat("/study-interaction","/datasets/").concat(this.state.datasetDir,"/").concat(s[i].file)).then((e=>e.json())).then((e=>{let s=e;t[i]=s})).then((()=>{this.setState({mappings:t,embeddings_data:t[0]})}))}prepareDatasets(e){let t=[],s=[];for(let i in this.state.settings.embeddings)console.log(this.state.settings.embeddings[i].name),t[i]=this.state.settings.embeddings[i].name,s[i]=this.state.settings.embeddings[i].directory;this.setState({dataset_options:t,dataset_dirs:s})}changeDataset(e){let t=this.state.dataset_options.indexOf(e),s=this.state.dataset_dirs[t];this.setState({selectedDataset:e,datasetDir:s,algorithm_options:null,embeddings_data:null,mappings:null,metadata:null}),this.loadConfig(s)}loadInit(e){fetch("".concat("/study-interaction","/")+e).then((e=>e.json())).then((e=>{let t=[],s=[];for(let i in e.data)console.log(e.data[i].directory),t[i]=e.data[i].name,s[i]=e.data[i].directory;if(this.setState({dataset_options:t,dataset_dirs:s}),null===this.state.selectedDataset)this.setState({selectedDataset:e.data[e.default].name,datasetDir:e.data[e.default].directory});else{let t=!1;for(let s in e.data)e.data[s].name===this.state.selectedDataset&&(this.setState({datasetDir:e.data[s].directory}),t=!0);t||this.setState({selectedDataset:e.data[e.default].name,datasetDir:e.data[e.default].directory})}})).then((()=>this.loadConfig(this.state.datasetDir)))}loadSettings(e){fetch("".concat("/study-interaction","/")+e).then((e=>e.json())).then((e=>{try{const s=e.clusters.clusterColors.map(i);function i(e){return[P()(e).rgb().array()[0]/255,P()(e).rgb().array()[1]/255,P()(e).rgb().array()[2]/255]}e.clusters.clusterColors=s}catch(t){}this.setState({settings:e})})).then((()=>this.prepareMappings(0))).then((()=>this.loadDataset(0)))}loadMetadata(e){fetch("".concat("/study-interaction","/")+e).then((e=>e.json())).then((e=>this.setState({metadata:e})))}loadBarData(e){fetch("".concat("/study-interaction","/")+e).then((e=>e.json())).then((e=>this.setState({barData:e})))}render(){return this.state.embeddings_data&&this.state.metadata?Object(c.jsx)(A,{...this.state,algorithm_name:this.state.algorithm_name,algorithm_options:this.state.algorithm_options,dataset_options:this.state.dataset_options,dataset_dirs:this.state.dataset_dirs,changeDataset:this.changeDataset.bind(this),selectedDataset:this.state.selectedDataset,participantId:this.state.participantId,datasetDir:this.state.datasetDir}):Object(c.jsxs)("div",{className:"loading",children:[Object(c.jsx)(O.a,{color:"inherit"}),Object(c.jsx)("div",{children:"loading datasets... "})]})}}var I,F=(I=M,e=>Object(c.jsx)(I,{...e,params:Object(l.q)(),navigate:Object(l.o)()}));function k(){return Object(c.jsx)(o.a,{children:Object(c.jsxs)(l.c,{children:[Object(c.jsx)(l.a,{exact:!0,path:"/",element:Object(c.jsx)(F,{})}),Object(c.jsx)(l.a,{exact:!0,path:"/study-interaction",element:Object(c.jsx)(F,{})})]})})}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(Object(c.jsx)(k,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((e=>{e.unregister()}))}},[[134,1,2]]]);
//# sourceMappingURL=main.55eb1e28.chunk.js.map